<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Milliways Code Review Week of {{since_date}} to {{today}}</title>
<style type="text/css">
body{
    width: 100%;
}
div.container {
    width: 550px;
    margin: 5px auto;
}
h1,h2 {
    text-align: center;
}
.revList {
    list-style-type: none;
    font-family: monospace;
    text-align: left;
}
textarea {
    display: block;
    width: 75%;
    height: 50em;
    margin-left: auto;
    margin-right: auto;
}
fieldset {
    margin: 2px auto;
    text-align: center;
    border: 0px;
}
select#authorsList {
    height:200px;
    width: 400px;
    margin: 10px auto;
    display: block;
}
button {
    display: inline;
    margin: 2px;
}

#reviewContainer {
    display: none;
    background-color: rgba(0, 0, 0, 0.84);
    position: absolute;
    top: 0;
    left: 0;
    margin: auto;
    width: 100%;
    height: 100%;
    z-index: 10;
}

#reviewButtons {
    text-align: center;
    margin: 5px auto;
}

#reviewButtons button {
    font-family: Helvetica,Arial;
    font-weight: bold;
    font-size: 14pt;
}

#reviewPortal {
    height: 88%;
    margin: 10px 50px;
    padding: 0px 0px;
    background-color: #E4E4E4;
    border: 6px ridge #1295B6;
}

#reviewPortal iframe {
    width: 100%;
    height: 100%;

}

</style>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script type="text/javascript">

function updateAuthorsList(event) {
    var authorsList = $("#authorsList").val();
    var revList = $("pre.revList");
    revList.hide();

    revList.filter(function(i){
        var this_author = $("input[name='author']", this).val();
        return $.inArray( this_author, authorsList ) != -1
    }).show();
}

function initializeAuthorsSelect() {
    // populate a set of authors
    var authors_array = new Array();
    $("input[name='author']").each(function(i, v){
        var name = $(v).val();
        if( $.inArray(name, authors_array) == -1 ){
            authors_array.push(name);
        }
    });
    // then sort
    authors_array.sort();
    // fill the multi-select with authors
    $.each(authors_array, function(i, item){
        var option = $(document.createElement("option"));
        option.attr("value", item);
        option.attr("selected", "selected");
        option.text( item );
        $("#authorsList").append(option);
    });
}

function testAccess(event) {
    window.open("https://bullhorn.beanstalkapp.com/coldfusion");
}

function openAllShown(event) {
    var confirmed = window.confirm("This will open lots of stuff\nAre you sure?");
    if (confirmed) {
        var linkArray = $("pre.revList:visible a").toArray();

        function openerFunc() {
            if( linkArray.length > 0 ) {
                var item = linkArray.pop()
                var href = item.getAttribute("href");
                var target = $(item).text();
                window.open(href, target);
            } else {
                window.clearTimeout(window.openerPID);
                window.openerPID = null;
            }
        }

        window.openerPID = window.setInterval(openerFunc, 200);
    }
}

$(document).ready(function(){
    initializeAuthorsSelect();

    //next setup the hide/show event function
    $("#authorsList").on('change', updateAuthorsList);
    $("#testAccessButton").click(testAccess);
    $("#goButton").click(openAllShown);

});
</script>
</head>
<body>

<div class="container">
    <h1>Milliways Code Review </h1>
    <h2>Week of {{since_date}} to {{today}}</h2>

<fieldset>
<select id="authorsList" multiple="multiple" autofocus="autofocus">
</select>

<button id="testAccessButton">Test Access</button>
<button id="goButton">&gt;&gt; GO! &lt;&lt;</button>
</fieldset>

{{#revs}}
<pre class="revList"><input type="hidden" name="author" value="{{author}}">
<a href="https://bullhorn.beanstalkapp.com/coldfusion/changesets/{{commit}}" target="_blank">{{commit}}</a>
{{log}}
</pre>
{{/revs}}
</div>
<!-- <textarea readonly>{{raw_log}}</textarea> -->
<div id="reviewContainer">
    <div id="reviewButtons">
        <button>&#8635; Reload </button>
        <button>&#8668; Previous</button>
        <button>Next &#8669;</button>
        <button>&#10005; Close</button>
    </div>
    <div id="reviewPortal">
        <iframe src="https://bullhorn.beanstalkapp.com/coldfusion" seamless="seamless">
    </div>
</div>

</body>
</html>